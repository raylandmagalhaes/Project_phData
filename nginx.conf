# Simple NGINX configuration for proxying requests to the Django application.
#
# The upstream block defines a group of backend servers.  In this case we
# reference the ``web`` service defined in docker-compose.yml, which runs
# Gunicorn inside a Python container.  Should you scale the web service to
# multiple replicas (for example, ``docker-compose up --scale web=3``),
# Docker automatically assigns each replica a unique hostname (e.g.
# ``web``, ``web_1``, ``web_2``).  You can list those here to enable
# round‑robin load balancing.  NGINX proxies requests to the upstream in
# a way that balances the load and improves fault tolerance【58967053478714†L421-L423】.

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    upstream django {
        # List of application servers.  Add additional entries when scaling
        # horizontally.  For example:
        # server web:8000;
        # server web_1:8000;
        # server web_2:8000;
        # Without weights specified NGINX uses round‑robin balancing by
        # default【58967053478714†L548-L560】.
        server web:8000;
    }

    server {
        listen 80;
        # Forward all requests to the upstream group
        location / {
            proxy_pass http://django;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}